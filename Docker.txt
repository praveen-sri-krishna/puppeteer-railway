# Use official Node image
FROM node:20-slim

# Install required dependencies for Puppeteer
RUN apt-get update && apt-get install -y \
    wget \
    ca-certificates \
    fonts-liberation \
    libappindicator3-1 \
    libasound2 \
    libatk-bridge2.0-0 \
    libatk1.0-0 \
    libcups2 \
    libdbus-1-3 \
    libgdk-pixbuf2.0-0 \
    libnspr4 \
    libnss3 \
    libx11-xcb1 \
    libxcomposite1 \
    libxdamage1 \
    libxrandr2 \
    xdg-utils \
    --no-install-recommends \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Create app directory
WORKDIR /app

# Copy and install dependencies
COPY package*.json ./

#  Add stealth plugins and proxy-chain during install
RUN npm install \
    puppeteer \
    puppeteer-extra \
    puppeteer-extra-plugin-stealth \
    proxy-chain

COPY . .

# Expose port
EXPOSE 3000

# Start the app
CMD ["node", "index.js"]

# Existing commands...

# Copy autoscraper files into /app folder
COPY autoscraper/ai-planner.js /app/ai-planner.js
COPY autoscraper/smart-scraper.js /app/smart-scraper.js
COPY autoscraper/ai-validator.js /app/ai-validator.js
COPY autoscraper/performance-db.js /app/performance-db.js
COPY autoscraper/auto-scale.js /app/auto-scale.js

# Optionally copy strategy.json or ads.json if you have them
# COPY autoscraper/strategy.json /app/strategy.json
# COPY autoscraper/ads.json /app/ads.json
